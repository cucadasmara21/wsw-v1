services:
  wsw-postgres:
    container_name: wsw-postgres
    image: postgres:16
    command:
      - "postgres"
      - "-c"
      - "max_connections=${WSW_MAX_CONNECTIONS:-20}"
      - "-c"
      - "shared_buffers=${WSW_SHARED_BUFFERS:-8GB}"
      - "-c"
      - "work_mem=${WSW_WORK_MEM:-64MB}"
      - "-c"
      - "effective_cache_size=${WSW_EFFECTIVE_CACHE_SIZE:-24GB}"
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: wsw_db
    ports:
      - "5432:5432"
    volumes:
      - wsw-postgres-data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres -d wsw_db -h 127.0.0.1 -p 5432"]
      interval: 2s
      timeout: 3s
      retries: 30

volumes:
  wsw-postgres-data:


