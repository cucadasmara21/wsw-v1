{"openapi":"3.1.0","info":{"title":"WallStreetWar API","description":"Sistema de riesgo sistémico financiero (MVP Replit)","version":"1.0.0"},"paths":{"/api/auth/register":{"post":{"tags":["auth"],"summary":"Register","description":"Register a new user account.\n\nArgs:\n    user_data (UserCreate): User registration data including username, email, password, full_name, and role.\n    db (Session): Database session (dependency injected).\n\nReturns:\n    UserSchema: The newly created user object.\n\nRaises:\n    HTTPException: 400 if username or email already exists.","operationId":"register_api_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/token":{"post":{"tags":["auth"],"summary":"Login","description":"Authenticate user and return JWT access token.\n\nArgs:\n    form_data (OAuth2PasswordRequestForm): Username and password from form submission.\n    db (Session): Database session (dependency injected).\n\nReturns:\n    Token: Object containing access_token and token_type (\"bearer\").\n\nRaises:\n    HTTPException: 401 if username not found or password verification fails.","operationId":"login_api_auth_token_post","requestBody":{"content":{"application/x-www-form-urlencoded":{"schema":{"$ref":"#/components/schemas/Body_login_api_auth_token_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/me":{"get":{"tags":["auth"],"summary":"Read Users Me","description":"Obtener usuario actual","operationId":"read_users_me_api_auth_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/api/assets":{"get":{"tags":["assets"],"summary":"List Assets","operationId":"list_assets_api_assets_get","parameters":[{"name":"q","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Search by symbol or name","title":"Q"},"description":"Search by symbol or name"},{"name":"category_id","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Category Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"default":50,"title":"Limit"}},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","minimum":0,"default":0,"title":"Offset"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PagedAssetsOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/assets/{asset_id}":{"get":{"tags":["assets"],"summary":"Asset Detail","operationId":"asset_detail_api_assets__asset_id__get","parameters":[{"name":"asset_id","in":"path","required":true,"schema":{"type":"integer","title":"Asset Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AssetDetailOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/assets/{asset_id}/risk_history":{"get":{"tags":["assets"],"summary":"Asset Risk History","operationId":"asset_risk_history_api_assets__asset_id__risk_history_get","parameters":[{"name":"asset_id","in":"path","required":true,"schema":{"type":"integer","title":"Asset Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":2000,"minimum":1,"default":200,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/RiskSnapshotOut"},"title":"Response Asset Risk History Api Assets  Asset Id  Risk History Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/risk/overview":{"get":{"tags":["risk"],"summary":"Get Risk Overview","description":"Return an aggregated risk overview as of the latest snapshot per asset.\nUses sqlite3 direct queries against the configured DATABASE_URL sqlite file (avoids SQLAlchemy/ORM).","operationId":"get_risk_overview_api_risk_overview_get","parameters":[{"name":"top_n","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"default":10,"title":"Top N"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RiskOverviewResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/risk/summary_sql":{"get":{"tags":["risk"],"summary":"Risk Summary Sql","description":"Return a summary using raw sqlite3 queries (SQL-only fallback for /summary).\nThis avoids SQLAlchemy mapper FK issues by querying `risk_snapshots` directly.","operationId":"risk_summary_sql_api_risk_summary_sql_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RiskSummaryResponse"}}}}}}},"/api/risk/timeseries/{asset_id}":{"get":{"tags":["risk"],"summary":"Get Risk Timeseries","operationId":"get_risk_timeseries_api_risk_timeseries__asset_id__get","parameters":[{"name":"asset_id","in":"path","required":true,"schema":{"type":"string","title":"Asset Id"}},{"name":"days","in":"query","required":false,"schema":{"type":"integer","maximum":365,"minimum":1,"default":30,"title":"Days"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/RiskSeriesPointOut"},"title":"Response Get Risk Timeseries Api Risk Timeseries  Asset Id  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/risk/asset/{asset_id}":{"get":{"tags":["risk"],"summary":"Get Asset Risk","description":"Obtener métricas de riesgo para un activo específico","operationId":"get_asset_risk_api_risk_asset__asset_id__get","parameters":[{"name":"asset_id","in":"path","required":true,"schema":{"type":"integer","title":"Asset Id"}},{"name":"days","in":"query","required":false,"schema":{"type":"integer","maximum":365,"minimum":1,"default":30,"title":"Days"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/risk/summary":{"get":{"tags":["risk"],"summary":"Risk Summary","description":"Return aggregated risk rows per group/subgroup/category using SQL joins (avoid ORM relationship inference).\nUses latest snapshot per asset (max ts).","operationId":"risk_summary_api_risk_summary_get","parameters":[{"name":"level","in":"query","required":false,"schema":{"type":"string","pattern":"^(group|subgroup|category)$","default":"category","title":"Level"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/RiskSummaryRow"},"title":"Response Risk Summary Api Risk Summary Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/risk/top":{"get":{"tags":["risk"],"summary":"Top Risks","description":"Return top assets by latest CRI using raw SQL to avoid mapper FK issues.","operationId":"top_risks_api_risk_top_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"default":15,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/scenarios/run":{"post":{"tags":["scenarios"],"summary":"Run Stress Scenario","description":"Execute a predefined stress test scenario.\n\nArgs:\n    scenario_name (str): Name of the scenario to run. Supported scenarios:\n        - `market_crash`: Simulates 2008 market crash (-50% SPY shock)\n        - `covid_crash`: Simulates 2020 COVID crash (-35% SPY shock)\n\nReturns:\n    dict: Scenario execution result with status, timestamp, and completion message.\n\nRaises:\n    HTTPException: 404 if scenario_name not found in predefined scenarios.","operationId":"run_stress_scenario_api_scenarios_run_post","parameters":[{"name":"scenario_name","in":"query","required":true,"schema":{"type":"string","title":"Scenario Name"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/":{"get":{"summary":"Root","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/health":{"get":{"summary":"Health Check","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/version":{"get":{"tags":["System"],"summary":"Version","description":"Return build info including git sha, build time, and environment","operationId":"version_version_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/status":{"get":{"summary":"System Status","operationId":"system_status_api_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/config":{"get":{"summary":"Get Config","operationId":"get_config_api_config_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"AssetDetailOut":{"properties":{"id":{"type":"integer","title":"Id"},"symbol":{"type":"string","title":"Symbol"},"name":{"type":"string","title":"Name"},"asset_type":{"type":"string","title":"Asset Type"},"category_id":{"type":"integer","title":"Category Id"},"latest":{"anyOf":[{"$ref":"#/components/schemas/RiskSnapshotOut"},{"type":"null"}]}},"type":"object","required":["id","symbol","name","asset_type","category_id"],"title":"AssetDetailOut"},"AssetOut":{"properties":{"id":{"type":"integer","title":"Id"},"symbol":{"type":"string","title":"Symbol"},"name":{"type":"string","title":"Name"},"asset_type":{"type":"string","title":"Asset Type"},"category_id":{"type":"integer","title":"Category Id"}},"type":"object","required":["id","symbol","name","asset_type","category_id"],"title":"AssetOut"},"Body_login_api_auth_token_post":{"properties":{"grant_type":{"anyOf":[{"type":"string","pattern":"^password$"},{"type":"null"}],"title":"Grant Type"},"username":{"type":"string","title":"Username"},"password":{"type":"string","format":"password","title":"Password"},"scope":{"type":"string","title":"Scope","default":""},"client_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Client Id"},"client_secret":{"anyOf":[{"type":"string"},{"type":"null"}],"format":"password","title":"Client Secret"}},"type":"object","required":["username","password"],"title":"Body_login_api_auth_token_post"},"GroupAgg":{"properties":{"group_name":{"type":"string","title":"Group Name"},"count":{"type":"integer","title":"Count"},"cri_avg":{"type":"number","title":"Cri Avg"},"vector_avg":{"$ref":"#/components/schemas/RiskVector"}},"type":"object","required":["group_name","count","cri_avg","vector_avg"],"title":"GroupAgg"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"PagedAssetsOut":{"properties":{"total":{"type":"integer","title":"Total"},"items":{"items":{"$ref":"#/components/schemas/AssetOut"},"type":"array","title":"Items"}},"type":"object","required":["total","items"],"title":"PagedAssetsOut"},"RiskOverviewResponse":{"properties":{"as_of":{"type":"string","title":"As Of"},"universe":{"type":"integer","title":"Universe"},"cri_avg":{"type":"number","title":"Cri Avg"},"vector_avg":{"$ref":"#/components/schemas/RiskVector"},"top_assets":{"items":{"$ref":"#/components/schemas/TopAsset"},"type":"array","title":"Top Assets"},"by_group":{"items":{"$ref":"#/components/schemas/GroupAgg"},"type":"array","title":"By Group"}},"type":"object","required":["as_of","universe","cri_avg","vector_avg","top_assets","by_group"],"title":"RiskOverviewResponse"},"RiskSeriesPointOut":{"properties":{"ts":{"type":"string","title":"Ts"},"cri":{"type":"number","title":"Cri"},"price_risk":{"type":"number","title":"Price Risk"},"fundamental_risk":{"type":"number","title":"Fundamental Risk"},"liquidity_risk":{"type":"number","title":"Liquidity Risk"},"counterparty_risk":{"type":"number","title":"Counterparty Risk"},"regime_risk":{"type":"number","title":"Regime Risk"}},"type":"object","required":["ts","cri","price_risk","fundamental_risk","liquidity_risk","counterparty_risk","regime_risk"],"title":"RiskSeriesPointOut"},"RiskSnapshotOut":{"properties":{"ts":{"type":"string","format":"date-time","title":"Ts"},"price_risk":{"type":"number","title":"Price Risk"},"liq_risk":{"type":"number","title":"Liq Risk"},"fund_risk":{"type":"number","title":"Fund Risk"},"cp_risk":{"type":"number","title":"Cp Risk"},"regime_risk":{"type":"number","title":"Regime Risk"},"cri":{"type":"number","title":"Cri"},"model_version":{"type":"string","title":"Model Version"}},"type":"object","required":["ts","price_risk","liq_risk","fund_risk","cp_risk","regime_risk","cri","model_version"],"title":"RiskSnapshotOut"},"RiskSummaryResponse":{"properties":{"as_of":{"type":"string","title":"As Of"},"universe":{"type":"integer","title":"Universe"},"cri_avg":{"type":"number","title":"Cri Avg"},"vector_avg":{"$ref":"#/components/schemas/RiskVector"},"top_risks":{"additionalProperties":{"items":{"$ref":"#/components/schemas/TopAsset"},"type":"array"},"type":"object","title":"Top Risks"}},"type":"object","required":["as_of","universe","cri_avg","vector_avg","top_risks"],"title":"RiskSummaryResponse"},"RiskSummaryRow":{"properties":{"level":{"type":"string","title":"Level"},"id":{"type":"integer","title":"Id"},"name":{"type":"string","title":"Name"},"parent_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Parent Id"},"avg_cri":{"type":"number","title":"Avg Cri"},"avg_price_risk":{"type":"number","title":"Avg Price Risk"},"avg_liq_risk":{"type":"number","title":"Avg Liq Risk"},"avg_fund_risk":{"type":"number","title":"Avg Fund Risk"},"avg_cp_risk":{"type":"number","title":"Avg Cp Risk"},"avg_regime_risk":{"type":"number","title":"Avg Regime Risk"},"n_assets":{"type":"integer","title":"N Assets"}},"type":"object","required":["level","id","name","avg_cri","avg_price_risk","avg_liq_risk","avg_fund_risk","avg_cp_risk","avg_regime_risk","n_assets"],"title":"RiskSummaryRow"},"RiskVector":{"properties":{"price_risk":{"type":"number","title":"Price Risk"},"fundamental_risk":{"type":"number","title":"Fundamental Risk"},"liquidity_risk":{"type":"number","title":"Liquidity Risk"},"counterparty_risk":{"type":"number","title":"Counterparty Risk"},"regime_risk":{"type":"number","title":"Regime Risk"}},"type":"object","required":["price_risk","fundamental_risk","liquidity_risk","counterparty_risk","regime_risk"],"title":"RiskVector"},"Token":{"properties":{"access_token":{"type":"string","title":"Access Token"},"token_type":{"type":"string","title":"Token Type"},"refresh_token":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Refresh Token"}},"type":"object","required":["access_token","token_type"],"title":"Token"},"TopAsset":{"properties":{"asset_id":{"type":"string","title":"Asset Id"},"asset_name":{"type":"string","title":"Asset Name"},"group_name":{"type":"string","title":"Group Name"},"subgroup_name":{"type":"string","title":"Subgroup Name"},"category_name":{"type":"string","title":"Category Name"},"cri":{"type":"number","title":"Cri"},"risk_vector":{"$ref":"#/components/schemas/RiskVector"}},"type":"object","required":["asset_id","asset_name","group_name","subgroup_name","category_name","cri","risk_vector"],"title":"TopAsset"},"User":{"properties":{"email":{"type":"string","title":"Email"},"username":{"type":"string","title":"Username"},"full_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Full Name"},"role":{"type":"string","title":"Role","default":"retail"},"id":{"type":"integer","title":"Id"},"is_active":{"type":"boolean","title":"Is Active"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"last_login":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Login"}},"type":"object","required":["email","username","id","is_active","created_at"],"title":"User"},"UserCreate":{"properties":{"email":{"type":"string","title":"Email"},"username":{"type":"string","title":"Username"},"full_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Full Name"},"role":{"type":"string","title":"Role","default":"retail"},"password":{"type":"string","title":"Password"}},"type":"object","required":["email","username","password"],"title":"UserCreate"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"OAuth2PasswordBearer":{"type":"oauth2","flows":{"password":{"scopes":{},"tokenUrl":"/api/auth/token"}}}}}}